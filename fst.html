<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>FST</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>FST</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_functional_amp_strongly_typed">Functional &amp; strongly-typed</h2>
<div class="sectionbody">
<div class="paragraph"><p>After reading this heading at the Cake Solutions blog, you’re no doubt thinking of Scala. Let’s highlight the functional and strongly-typed nature of Scala, and see if we can find some commonalities between functions and types: beginners in the language will be able to spot the similarities between types and values.</p></div>
<div class="sect2">
<h3 id="_functions_and_their_application">Functions and their application</h3>
<div class="paragraph"><p>To define a function in Scala, we add it to a container ([<code>case</code>] <code>class</code>, <code>object</code>, or <code>trait</code>); alternatively we define a variable that holds a function.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph"><p>A function here is a SAM (single anonymous method) class. Very broadly speaking, Java creates the SAM class at first application <code>invokedynamic</code>. Both methods and functions are then called using <code>invokevirtual</code> or <code>invokeinterface</code>.</p></div>
</div></div>
<div class="paragraph"><p>I’ll use the term function from now on, for convenience and because they feel the same way in the Scala source code, but keep in mind that there is a difference. Let’s define <code>trait Functions</code> (a <code>trait</code> so we can use it later in <code>object FunctionsMain extends App with Functions { ... }</code>):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>trait Functions {
  type Result = …
  def foo(I: Int, j: Int): Result = …
}</code></pre>
</div></div>
<div class="paragraph"><p>It should not be surprising that to get the result of <code>foo</code>, we have to supply the parameters. (More accurately, supply the parameters in all parameter lists.) The “shape” of <code>foo</code> is <code>Int, Int</code> to <code>Result</code>. To get to the value, we write <code>foo(1, 2)</code>. If we do not supply the value of all the parameters; if we write <code>val x = foo(1, _ : Int)</code>, the result is a <em>partially-applied function</em>. In this case, <code>x</code> is a variable of type <code>Int =&gt; Result</code>; a first-class function! When we apply it to the remaining parameter <em>x</em>, we get back the result—the same result we would get if we called <code>foo(1, x)</code>. In partial application, we supply some, but not all, parameters to the function, and we get back a function that takes the remaining parameters. It is possible, though clumsy and unnecessary, to write <code>({ val f = foo(1, _ : Int); f })(2)</code> instead of <code>foo(1, 2)</code>.</p></div>
</div>
<div class="sect2">
<h3 id="_currying">Currying</h3>
<div class="paragraph"><p>To complete the discussion, let’s tackle currying. Where partial application is a process of reducing the number of parameters in a single parameter list, currying is a process of reducing the number of parameter lists. In Scala, we can define a function to have any number of parameter lists.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph"><p>Most languages operate on parameters in parameter lists, and most languages have only one parameter list. A function <code>foo</code> with parameters of type <code>a</code> and <code>b</code>, returning type <code>r</code> written in a “natural” style (typically <code>foo(p1: a, p2: b): r</code> or <code>r foo(a p1, b p2)</code> is treated as <code>(a, b)</code> to  <code>r</code>: single parameter list with two elements to result. ML-like languages such as Haskell and F#, however, would translate their “natural” style (<code>foo ∷ a -&gt; b -&gt; r; foo p1 p2 = ...</code> or <code>foo (p1:a) (p2:b) : r</code>) to mean <code>a</code> to <code>b</code> to <code>r</code>: first parameter list to a function taking the remaining parameter list to result. Consequently, ML-style languages firstly curry, while others firstly partially apply.</p></div>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>trait Functions {
  type Result = …
  def fooc(I: Int)(j: Int): Result = …
}</code></pre>
</div></div>
<div class="paragraph"><p>The “shape” of <code>fooc</code> is not <code>Int, Int</code> to <code>Result</code>, but <code>Int</code> to (<code>Int</code> to <code>Result</code>). To get to the final result, we write <code>fooc(1)(2)</code>. Writing <code>fooc(1)</code> yields a function that takes an <code>Int</code> and returns a <code>Result</code>. Think of the call <code>fooc(1)(2)</code> as <code>({ val f = fooc(1); f(2) })</code>. You may find this useful when writing functions that need some additional parameters, but need to be used in a place where only one parameter is used. Consider mapping over list of integers using a function that adds one to each element. We can write</p></div>
<div class="listingblock">
<div class="content">
<pre><code>def add(a: Int, b: Int): Int = a + b
List(1, 2, 3).map(x =&gt; add(1, x))
List(…).map(x =&gt; add(2, x))</code></pre>
</div></div>
<div class="paragraph"><p>But it is more æsthetically pleasing and more efficient (why?) to have</p></div>
<div class="listingblock">
<div class="content">
<pre><code>def add(a: Int)(b: Int): Int = a + b
List(1, 2, 3).map(add(1))
List(…).map(add(2))</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_types_amp_kinds">Types &amp; kinds</h2>
<div class="sectionbody">
<div class="paragraph"><p>So, we’re happy with applying functions. We are also happy that there can be a <em>thing</em> that can be applied to parameters (or parameter lists) to yield a result. We are in a strongly-typed language, so the types of the parameters in the parameter lists are well-defined, together with the result type. We are used to saying "function from <code>Int</code> to <code>Int</code>"; we are also used to the fact that once we supply all the parameter [lists], we get the result value.
It turns out that the same principle applies to types. The types we were using earlier are concrete types—they are fully-formed, they are not waiting for any parameters to be supplied. An <code>Int</code> is a fully-constructed type, just like <code>String</code>. We say that their <em>kind</em> is <code>*</code>. Just like there are functions / methods that take parameters, there are types that take parameters. Our familiar <code>List</code> is just that. The kind of <code>List</code> is <code>* -&gt; *</code>: <code>List</code> on its own is not a concrete type, it is a <em>type constructor</em>. If this were a function, it would be a function that takes one parameter and yields a result. But it is not a function, the parameter given to <code>List</code> cannot be a runtime value; it needs to be a compile-time type. Also, the syntax is slightly different. Where function application uses parentheses, type application takes square brackets. And so, we can apply the <code>List</code> type constructor to type parameter <code>Int</code>, writing <code>List[Int]</code>. The kind of <code>List[Int]</code> is obviously <code>*</code>: we have applied the type constructor to all its type parameters, we are left with a concrete type. (Just like applying a function to all its parameters yields the return value.) Similarly, <code>List[List[String]]</code> is of kind <code>*</code>. It is a compile error to say <code>List[1]</code>: <code>1</code> is a <em>value</em>, where <code>List</code> expects a <em>type</em>, just as much as it is a compile error to say <code>foo(Int)</code>: <code>Int</code> is a type, not a value.
Let’s explore this further and define a function <code>foom</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>trait Functions {
  type Result = …
  def foom[M[_]]: Result = …
}</code></pre>
</div></div>
<div class="paragraph"><p>The kind of <code>M</code> is <code>* -&gt; *</code>: it takes one type parameter (denoted by <code>_</code>) and yields a concrete type. So, what type parameter can we give to the function <code>foom[M[_]]</code>? We can’t have <code>foom[Int]</code>: the kind of <code>Int</code> is <code>*</code>, but we need <code>* -&gt; *</code>. Taking the Scala standard library, we can use <code>Option</code>, <code>List</code>, <code>Seq</code>, etc; any type that needs exactly one type parameter to yield a concrete type. (For example, the kind of <code>Option</code>, <code>List</code> is <code>* -&gt; *</code>; their definition is <code>sealed abstract class Option[+A]</code>; <code>sealed abstract class List[+A]</code>.) Now, we can’t write <code>foom[Either]</code>, because the kind of <code>Either</code> is <code>(*, *) -&gt; *</code>; recall that <code>Either</code> takes two type parameters before yielding a concrete type. After reading about partial applications of functions, it would be reasonable to assume that we can partially apply a type constructor; in other words, to partially apply <code>(*, *) -&gt; *</code> to some concrete type, yielding <code>* -&gt; *</code>. Let’s take a long-winded route and name the partially-applied <code>Either</code> type. We have <code>type EitherS[R] = Either[String, R]</code>; we can now have <code>foom[EitherS]</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>trait Functions {
  type Result = …
  def foom[M[_]]: Result = …
  type EitherS[R] = Either[String, R]
}</code></pre>
</div></div>
<div class="paragraph"><p>Sometimes we want to partially apply a type constructor, just like we can partially apply functions, without explicitly naming them. If we want to partially apply <code>Either</code> by fixing its first parameter to be a <code>String</code>, we can’t write <code>foom[Either[String, _]]</code>. It is not valid syntax, <code>_</code> here does not mean “partially apply type”. Instead, we have to name a type that takes the remaining type parameters in a block, and then access it as a member of that block. We will name our partially applied type <code>λ</code>, and make it take one type parameter. In valid Scala syntax, we have <code>({type λ[R] = Either[String, R]})#λ</code>; its kind is <code>* -&gt; *</code>. Notice the similarity between this and partial function application: when we wanted to be difficult &amp; verbose, we wrote <code>({foo(1, _ : Int)})</code>. In case of the type partial application, we get back a type of kind <code>* -&gt; *</code>; in case of the function partial application, we get back a function of type <code>Int =&gt; String</code>.
Of course, the function <code>foom</code> cannot do anything useful (if it is to remain a pure function); perhaps it should be given a parameter of type <code>M[_]</code>: <code>foom[M[_]](m: M[_]): Result</code>. With that parameter, we can have <code>foom[({type λ[R] = Either[String, R]})#λ](Right(2))</code>. That’s jolly good, but what about the body of <code>foom</code>? We can’t make it do anything useful, because we don’t know anything about the type <code>M[_]</code> except that it exists and that its type parameter exists.</p></div>
<div class="sect2">
<h3 id="_type_classes">Type classes</h3>
<div class="paragraph"><p>Knowing that something exists is nice, but it does not help us to write code. We would find it more useful if we could say something in addition to this type&#8217;s existence. To help our imaginations, let’s invent a new function, and call it <code>fmap[M[_], A, B](f: A =&gt; B, m: M[A]): M[B]</code>. It is a very generic version of the function <code>map</code>. But we’re still stuck in the same position of knowing only existence. We would like to know, and allow others to specify, something about the various <code>M[_]</code> s, but not force any kind of hierarchy. We take advantage of the fact that <code>fmap</code> behaves differently for different types of <code>M</code>, the container, but it does not care about the elements. The concept we are defining here is a <em>functor</em>; and we wish to have different implementations according to the types.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>def fmap[M[_], A, B](f: A =&gt; B, m: M[A])(implicit F: Functor[M]): M[B] = F.fmap(f, m) 

trait Functor[M[_]] { 
  def fmap[A, B](f: A =&gt; B, m: M[A]): M[B] 
}</code></pre>
</div></div>
<div class="paragraph"><p>And then instances for <code>Option</code> and <code>List</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>implicit object OptionFunctor extends Functor[Option] { 
  override def fmap[A, B](f: A =&gt; B, m: Option[A]): Option[B] = m match { 
    case Some(a) =&gt; Some(f(a)) 
    case None =&gt; None 
  }
}

  implicit object ListFunctor extends Functor[List] { 
  override def fmap[A, B](f: A =&gt; B, m: List[A]): List[B] = m match { 
    case Nil =&gt; Nil 
    case h::t =&gt; f(h)::fmap(f, t) 
  }
 }</code></pre>
</div></div>
<div class="paragraph"><p>Now, can there be an instance of <code>Functor</code> for <code>Either</code>? I hope you are all shouting “no,” <code>Either</code> has kind <code>(*, *) -&gt; *</code>, but <code>Functor</code> needs <code>* -&gt; *</code>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why">Why?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Perhaps this question should have been at the start. Nevertheless, the motivation is to be able to extract common patterns and to apply these patterns to existing types, without introducing inheritance hierarchy. Consider our functor and its <code>fmap</code> function that now works on <code>Option</code> and <code>List</code>, even though the authors of <code>List</code> and <code>Option</code> did not include <code>fmap</code> in their definitions. If you find yourself writing similar code, you should attempt to make it as generic as possible. Once you master this in the world of values (i.e. spotting that there is a <code>map</code>, <code>find</code>, <code>foreach</code> operation), you should master this at the level of types. As further reading, head over to <a href="http://underscore.io/books/shapeless-guide/">http://underscore.io/books/shapeless-guide/</a> and explore Shapeless: a library for type-level programming.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2017-01-11 14:20:33 GMT
</div>
</div>
</body>
</html>
